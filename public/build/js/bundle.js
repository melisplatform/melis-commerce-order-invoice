$((function(){var e=$("body");function o(e,o,r,n,i,t){var c=new XMLHttpRequest;c.open(e,o),c.responseType="arraybuffer",null!=r?(c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send(r)):c.send(),c.onload=function(e){if(200==this.status){var o=new Blob([this.response],{type:n}),r=document.createElement("a"),t=window.URL.createObjectURL(o);r.href=t,r.download=c.getResponseHeader("fileName"),r.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),null==i&&null==i||i()}},null==t&&null==t||t()}e.on("click",".regenerate-invoice",(function(){var e=$(this).val();melisCoreTool.pending(".regenerate-invoice"),$.ajax({type:"POST",url:"/melis/MelisCommerceOrderInvoice/MelisCommerceOrderInvoice/generateOrderInvoice",data:{orderId:e},dataType:"json",encode:!0}).done((function(o){melisHelper.zoneReload(e+"_id_meliscommerce_orders_content_tabs_content_order_invoice_details","meliscommerce_orders_content_tabs_content_order_invoice_details",{orderId:e}),melisCoreTool.done(".regenerate-invoice")})).fail((function(){melisCoreTool.done(".regenerate-invoice"),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".export-invoice-pdf",(function(){var e="invoiceId="+$(this).closest("tr").data("invoiceid");melisCoreTool.pending(".export-invoice-pdf"),o("POST","/melis/MelisCommerceOrderInvoice/MelisCommerceOrderInvoice/getOrderInvoice",e,"application/pdf",(function(){melisCoreTool.done(".export-invoice-pdf")}),null)})),e.on("click",".export-order-pdf",(function(){var e=$(this).closest("tr").attr("id");melisCoreTool.pending(".export-order-pdf"),$.ajax({type:"POST",url:"/melis/MelisCommerceOrderInvoice/MelisCommerceOrderInvoice/getOrderLatestInvoiceId",data:{orderId:e},dataType:"json",encode:!0}).done((function(e){e.latestInvoiceId>0?o("POST","/melis/MelisCommerceOrderInvoice/MelisCommerceOrderInvoice/getOrderInvoice","invoiceId="+e.latestInvoiceId,"application/pdf",(function(){melisCoreTool.done(".export-order-pdf")}),null):(melisHelper.melisKoNotification(translations.tr_meliscommerce_order_invoice_export_prompt_title,translations.tr_meliscommerce_order_invoice_export_no_invoice),melisCoreTool.done(".export-order-pdf"))})).fail((function(){melisCoreTool.done(".export-order-pdf"),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".orderInvoiceTableRefresh",(function(){var e=$(this).closest(".container-level-a").attr("id"),o=isNaN(parseInt(e,10))?"":parseInt(e,10);melisHelper.zoneReload(o+"_id_meliscommerce_orders_content_tabs_content_order_invoice_details","meliscommerce_orders_content_tabs_content_order_invoice_details",{orderId:o})})),window.initOrderInvoiceTable=function(e,o){var r=$("#"+o.sTableId).data("orderid");e.orderId=r}}));
