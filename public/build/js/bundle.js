$(function(){function e(e,o,r,n,i,t){var c=new XMLHttpRequest;c.open(e,o),c.responseType="arraybuffer",null!=r?(c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send(r)):c.send(),c.onload=function(e){if(200==this.status){var o=new Blob([this.response],{type:n}),r=document.createElement("a"),t=window.URL.createObjectURL(o);r.href=t,r.download=c.getResponseHeader("fileName"),r.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),void 0==i&&null==i||i()}},void 0==t&&null==t||t()}var o=$("body");o.on("click",".regenerate-invoice",function(){var e=$(this),o=e.val();melisCoreTool.pending(".regenerate-invoice"),$.ajax({type:"POST",url:"/melis/MelisCommerceOrderInvoice/MelisCommerceOrderInvoice/generateOrderInvoice",data:{orderId:o},dataType:"json",encode:!0}).done(function(e){melisHelper.zoneReload(o+"_id_meliscommerce_orders_content_tabs_content_order_invoice_details","meliscommerce_orders_content_tabs_content_order_invoice_details",{orderId:o}),melisCoreTool.done(".regenerate-invoice")}).fail(function(){melisCoreTool.done(".regenerate-invoice"),alert(translations.tr_meliscore_error_message)})}),o.on("click",".export-invoice-pdf",function(){var o=$(this),r=o.closest("tr").data("invoiceid"),n="invoiceId="+r;melisCoreTool.pending(".export-invoice-pdf"),e("POST","/melis/MelisCommerceOrderInvoice/MelisCommerceOrderInvoice/getOrderInvoice",n,"application/pdf",function(){melisCoreTool.done(".export-invoice-pdf")},null)}),o.on("click",".export-order-pdf",function(){var o=$(this),r=o.closest("tr").attr("id"),n=null;melisCoreTool.pending(".export-order-pdf"),$.ajax({type:"POST",url:"/melis/MelisCommerceOrderInvoice/MelisCommerceOrderInvoice/getOrderLatestInvoiceId",data:{orderId:r},dataType:"json",encode:!0}).done(function(o){o.latestInvoiceId>0?(n="invoiceId="+o.latestInvoiceId,e("POST","/melis/MelisCommerceOrderInvoice/MelisCommerceOrderInvoice/getOrderInvoice",n,"application/pdf",function(){melisCoreTool.done(".export-order-pdf")},null)):(melisHelper.melisKoNotification(translations.tr_meliscommerce_order_invoice_export_prompt_title,translations.tr_meliscommerce_order_invoice_export_no_invoice),melisCoreTool.done(".export-order-pdf"))}).fail(function(){melisCoreTool.done(".export-order-pdf"),alert(translations.tr_meliscore_error_message)})}),o.on("click",".orderInvoiceTableRefresh",function(){var e=$(this),o=e.closest(".container-level-a").attr("id"),r=isNaN(parseInt(o,10))?"":parseInt(o,10);melisHelper.zoneReload(r+"_id_meliscommerce_orders_content_tabs_content_order_invoice_details","meliscommerce_orders_content_tabs_content_order_invoice_details",{orderId:r})}),window.initOrderInvoiceTable=function(e,o){var r=$("#"+o.sTableId).data("orderid");e.orderId=r}});